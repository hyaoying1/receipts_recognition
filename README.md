# 📘 票据识别 API 文档（Document Recognition API）

本接口用于上传票据图片并提取结构化字段。  
支持一次上传 **单张文件** 或 **多张文件**。  
所有请求均使用同一接口 `/predict`。


## 功能描述（Feature Description）

- 支持 JPG / PNG / JPEG / PDF（PDF 自动转换为 JPG）。
- 自动 OCR 文本识别。
- 自动判断文件类型：行程单 / 酒店水单 / 支付记录。
- 自动抽取结构化 JSON 字段。
- 支持批量识别（单次多个文件）。
- 返回总耗时 + 每个文件的识别结果。


## 接口概览

- **接口地址**：`POST http://172.20.201.93:8000/predict`
- **请求方式**：`multipart/form-data`
- **参数名**：`files`
- **支持多个文件**：是（1 个或多个文件均可）
- **支持格式**：JPG / PNG / JPEG / PDF



## 🧾  请求参数说明

| 参数名 | 类型  | 说明 |
|--------|--------|----------|
| files | File[]| 需要识别的图片文件，可上传 1 个或多个 |

> ⚠ 参数必须命名为 **files**（复数）。



## 输入限制
| 限制项 | 说明 |
|--------|------|
| 支持格式 | `.jpg`, `.jpeg`, `.png`, `.pdf` |
| PDF | 仅处理第一页，自动转成 JPG |
| 不支持格式 | HEIC、TIFF、ZIP、TXT、DOCX 等 |


## 请求示例（curl）

### 单文件上传
```
curl -X POST "http://172.20.201.93:8000/predict" \
  -F "files=@hotel1.jpg
```

###  多文件上传
```
curl -X POST "http://172.20.201.93:8000/predict" \
  -F "files=@hotel1.jpg" \
  -F "files=@payment2.jpg" \
  -F "files=@itinerary3.png"
```


## 返回数据结构
返回 JSON 结构如下：
```
{
  "total_time": number,
  "count": number,
  "files": [
    {
      "filename": "原始文件名",
      "result": {
         ...结构化字段 JSON... 
      }
    }
  ]
}

```
字段说明：

- total_time: 总处理耗时（秒）
- count: 文件个数
- files: 文件识别结果列表
- result.识别字段: 根据识别类型返回不同结构

## 返回示例
```
{
    "total_time": 8.09,
    "count": 3,
    "files": [
        {
            "filename": "支付记录3.jpg",
            "result": {
                "文件类型": "支付记录",
                "交易记录": [
                    {
                        "交易日期": "2025-11-14",
                        "交易金额": 64.4,
                        "币种": "CNY",
                        "商家": "滴滴出行"
                    }
                ],
                "总金额": 64.4
            }
        },
        {
            "filename": "百度地图打车-yyyymmdd.pdf",
            "result": {
                "文件类型": "行程单",
                "供应商": "百度地图",
                "申请日期": "2025-09-05",
                "开始日期": "2025-09-04",
                "结束日期": "2025-09-04",
                "行程": [
                    {
                        "城市": "北京",
                        "日期": "2025-09-04",
                        "开始时间": "2025-09-04 16:00:45",
                        "金额": 29.31,
                        "币种": "CNY"
                    },
                    {
                        "城市": "北京",
                        "日期": "2025-09-04",
                        "开始时间": "2025-09-04 08:09:10",
                        "金额": 24.61,
                        "币种": "CNY"
                    }
                ],
                "总金额": 53.92
            }
        },
        {
            "filename": "酒店水单刷卡单10+苏州希尔顿+0827+663.45.jpg",
            "result": {
                "文件类型": "酒店水单",
                "确认号": "3108321525",
                "入住日期": "2024-08-27",
                "离店日期": "2024-08-28",
                "城市": "Beijing",
                "总金额": 663.45,
                "币种": "CNY"
            }
        }
    ]
}

```
